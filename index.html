<!doctype html>
<html lang="my">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>MMK ↔ THB Calculator + Bank QR + Save JPEG</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

  <style>
    body { background:#f0f4f8; font-family:system-ui,-apple-system,Segoe UI,Roboto,sans-serif; }
    header { background:linear-gradient(to right,#2563eb,#10b981); color:white; padding:1.2rem; text-align:center; border-radius:0.7rem; margin-bottom:1rem; }
    .box { background:white; border-radius:1rem; box-shadow:0 2px 8px rgba(0,0,0,0.1); padding:1.25rem; margin-bottom:1.25rem; }
    .label { font-size:1.1rem; font-weight:700; display:inline-flex; align-items:center; gap:.5rem; }
    input, output, select { font-size:1.1rem; font-weight:600; }
    .sub { font-size:0.85rem; color:#4b5563; margin-bottom:0.3rem; }
    .rate-note { font-size:0.9rem; color:#6b7280; margin-top:0.4rem; font-weight:700; }
    .thanks { color:#059669; font-size:0.85rem; margin-top:0.6rem; }
    .btn { border-radius:0.75rem; border:none; background:#1f2937; color:white; padding:0.55rem 0.9rem; font-size:0.9rem; cursor:pointer; transition:background .2s, transform .05s; }
    .btn:hover { background:#0f172a; } .btn:active { transform:translateY(1px); }
    .flag { width:20px; height:auto; border-radius:2px; display:inline-block; }
    .card { border:1px solid #e5e7eb; border-radius:16px; padding:14px; background:#fff; }
    .export-block { margin-top: 14px; padding-top: 12px; border-top: 1px dashed #cbd5e1; text-align:center; }
    .muted { color:#64748b; font-size:0.9rem; }
  </style>
</head>

<body class="p-4">

<header>
  <h1 class="text-2xl font-bold">MMK ↔ THB ငွေလဲတွက်ချက်ခြင်း</h1>
  <p class="text-sm">MMK ↔ THB Exchange Calculator</p>
</header>

<main class="max-w-2xl mx-auto">

  <!-- 1) Rate Entry -->
  <section class="box">
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div>
        <label class="label">
          <img src="https://flagcdn.com/w20/th.png" alt="TH" class="flag">
          <span>မြန်မာငွေ ၁ သိန်း အတွက် ဘတ် (THB)</span>
        </label>
        <p class="sub">THB per 100,000 MMK</p>
        <input id="rate100k" class="w-full border rounded p-2" type="text" placeholder="820" inputmode="decimal">
      </div>

      <div>
        <label class="label">
          <img src="https://flagcdn.com/w20/mm.png" alt="MM" class="flag">
          <span>၁ ဘတ် အတွက် မြန်မာကျပ်</span>
        </label>
        <p class="sub">MMK per 1 THB</p>
        <input id="ratePerThb" class="w-full border rounded p-2" type="text" placeholder="121.95" inputmode="decimal">
      </div>
    </div>
  </section>

  <!-- 2) THB → MMK -->
  <section id="box-thb2mmk" class="box capture-target">
    <h2 class="text-lg font-semibold mb-2">ဘတ် → မြန်မာကျပ်</h2>
    <p class="sub">THB → MMK</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div>
        <label class="label">
          <img src="https://flagcdn.com/w20/th.png" alt="TH" class="flag">
          <span>ဘတ်ငွေ</span>
        </label>
        <p class="sub">Input THB</p>
        <input id="thbIn" class="w-full border rounded p-2" type="text" placeholder="6500" inputmode="numeric">
      </div>

      <div>
        <label class="label">
          <img src="https://flagcdn.com/w20/mm.png" alt="MM" class="flag">
          <span>မြန်မာကျပ်</span>
        </label>
        <p class="sub">Result MMK</p>
        <output id="mmkOut" class="block w-full rounded border bg-gray-50 p-2 min-h-[42px]"></output>
      </div>
    </div>

    <div class="text-center mt-3">
      <p class="rate-note" id="rateNote1"></p>
      <p class="text-red-600 font-semibold mt-2">ငွေလွှဲတိုင်း ဘဏ်အကောင့်တောင်းပေးပါ။</p>
      <p class="text-red-600 font-semibold mt-2">ဘဏ်အကောင့် မတောင်းဘဲ လွှဲလာသော မည်သည့် ငွေလွှဲမှ တာဝန်မယူပါ။</p>
      <p class="thanks">Thailand Guide - Supplier By Ye Page ကို ယုံကြည်စွာ အသုံးပြုမှုအတွက် ကျေးဇူးအထူးတင်ပါတယ်။</p>
    </div>

    <button id="btnSave1" type="button" class="btn mt-3">Save JPEG</button>
  </section>

  <!-- 3) MMK → THB -->
  <section id="box-mmk2thb" class="box capture-target">
    <h2 class="text-lg font-semibold mb-2">မြန်မာကျပ် → ဘတ်</h2>
    <p class="sub">MMK → THB</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
      <div>
        <label class="label">
          <img src="https://flagcdn.com/w20/mm.png" alt="MM" class="flag">
          <span>မြန်မာကျပ်</span>
        </label>
        <p class="sub">Input MMK</p>
        <input id="mmkIn" class="w-full border rounded p-2" type="text" placeholder="1000000" inputmode="numeric">
      </div>

      <div>
        <label class="label">
          <img src="https://flagcdn.com/w20/th.png" alt="TH" class="flag">
          <span>ဘတ်ငွေ</span>
        </label>
        <p class="sub">Result THB</p>
        <output id="thbOut" class="block w-full rounded border bg-gray-50 p-2 min-h-[42px]"></output>
      </div>
    </div>

    <div class="text-center mt-3">
      <p class="rate-note" id="rateNote2"></p>
      <p class="text-red-600 font-semibold mt-2">ငွေလွှဲတိုင်း ဘဏ်အကောင့်တောင်းပေးပါ။</p>
      <p class="text-red-600 font-semibold mt-2">ဘဏ်အကောင့် မတောင်းဘဲ လွှဲလာသော မည်သည့် ငွေလွှဲမှ တာဝန်မယူပါ။</p>
      <p class="thanks">Thailand Guide - Supplier By Ye Page ကို ယုံကြည်စွာ အသုံးပြုမှုအတွက် ကျေးဇူးအထူးတင်ပါတယ်။</p>
    </div>

    <button id="btnSave2" type="button" class="btn mt-3">Save JPEG</button>
  </section>

  <!-- 4) Save JPEG + Bank QR UI -->
  <section class="box">
    <h2 class="text-lg font-semibold mb-1">Save JPEG + Bank QR</h2>
    <p class="sub">QR / Bank Info / မပါ — တစ်ခုတည်းပဲရွေးနိုင်</p>

    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 items-start">

      <!-- Left -->
      <div class="card">
        <p class="font-semibold mb-2">QR Select</p>
        <select id="qrSelect" class="w-full border rounded p-2"></select>
        <p id="qrStatus" class="muted mt-2"></p>

        <hr class="my-3">

        <p class="font-semibold mb-2">Bank Info Select</p>
        <select id="bankSelect" class="w-full border rounded p-2"></select>

        <div id="bankInfoBox" class="mt-3 border rounded-xl p-3 bg-white hidden">
          <div class="flex items-center gap-3">
            <img id="bankLogo" alt="logo" class="rounded-md border bg-white" style="width:44px;height:44px;object-fit:cover;">
            <div>
              <p id="bankNameText" class="font-bold"></p>
              <p class="text-xs text-slate-500">Selected Bank</p>
            </div>
          </div>

          <div class="mt-3 text-sm text-slate-700">
            <div>ဘဏ်အကောင့်နာမည်: <span id="bankAccName" class="font-semibold"></span></div>
            <div class="mt-1">ဘဏ်အကောင့်နံပါတ်: <span id="bankAccNo" class="font-semibold font-mono"></span></div>
          </div>
        </div>

        <p id="bankInfoStatus" class="muted mt-2"></p>

        <hr class="my-3">

        <p class="font-semibold mb-2">Save JPEG ထဲ ဘာထည့်မလဲ (တစ်ခုတည်းရွေး)</p>

        <label class="flex items-center gap-2 mt-1">
          <input type="radio" name="saveMode" value="none" checked>
          <span>မပါ (Default)</span>
        </label>
        <label class="flex items-center gap-2 mt-1">
          <input type="radio" name="saveMode" value="bank">
          <span>Bank Info ပဲပါ</span>
        </label>
        <label class="flex items-center gap-2 mt-1">
          <input type="radio" name="saveMode" value="qr">
          <span>QR ပဲပါ</span>
        </label>

        <p class="text-xs text-slate-500 mt-2">
          Note: Radio သုံးထားလို့ တစ်ခုတည်းပဲရွေးနိုင်ပါတယ် (နှစ်ခုလုံးမပါ / နှစ်ခုလုံးပါ မဖြစ်)
        </p>
      </div>

      <!-- Right Preview -->
      <div class="card text-center">
        <p class="font-semibold">QR Preview</p>
        <img id="qrPreview" alt="QR Preview" class="mx-auto mt-2 rounded-xl border bg-white"
             style="width:220px; height:220px; object-fit:contain;">
        <p id="qrPreviewName" class="font-semibold mt-2"></p>

        <div class="mt-4 border-t pt-3 text-left">
          <p class="font-semibold text-center">Bank Info Preview</p>
          <div id="bankPreviewMini" class="text-sm text-slate-700 mt-2">
            ဘဏ်မရွေးထားသေးပါ။
          </div>
        </div>
      </div>

    </div>
  </section>

</main>

<script>
/* ================= helpers ================= */
function normalizeDigits(v){
  const map = {'၀':'0','၁':'1','၂':'2','၃':'3','၄':'4','၅':'5','၆':'6','၇':'7','၈':'8','၉':'9'};
  return (v || '').replace(/[၀၁၂၃၄၅၆၇၈၉]/g, d => map[d] ?? d);
}
const $ = s => document.querySelector(s);
const parseNum = v => {
  v = normalizeDigits(String(v).trim());
  const n = Number(v.replace(/,/g,''));
  return Number.isFinite(n) ? n : NaN;
};
const fmt0ceil = n => new Intl.NumberFormat('en-US',{minimumFractionDigits:0,maximumFractionDigits:0}).format(Math.ceil(n));
const fmt6 = n => new Intl.NumberFormat('en-US',{minimumFractionDigits:0,maximumFractionDigits:6}).format(n);

/* ================= calculator ================= */
function getRate(){
  const a = parseNum($('#rate100k').value);
  const b = parseNum($('#ratePerThb').value);
  if(Number.isFinite(a) && a>0) return a;
  if(Number.isFinite(b) && b>0) return 100000 / b;
  return NaN;
}
function refreshRateNote(){
  const r = getRate();
  if(Number.isFinite(r) && r>0){
    const inv = 100000 / r;
    $('#rateNote1').textContent = `မြန်မာငွေ ၁ သိန်း = ${fmt6(r)} ဘတ် | ၁ ဘတ် = ${fmt6(inv)} ကျပ်`;
    $('#rateNote2').textContent = `မြန်မာငွေ ၁ သိန်း = ${fmt6(r)} ဘတ် | ၁ ဘတ် = ${fmt6(inv)} ကျပ်`;
  }else{
    $('#rateNote1').textContent = '';
    $('#rateNote2').textContent = '';
  }
}
function recalc(){
  const rate = getRate();
  const thb  = parseNum($('#thbIn').value);
  const mmk  = parseNum($('#mmkIn').value);
  $('#mmkOut').textContent = (Number.isFinite(rate) && Number.isFinite(thb)) ? fmt0ceil(thb*100000/rate) + ' MMK' : '';
  $('#thbOut').textContent = (Number.isFinite(rate) && Number.isFinite(mmk)) ? fmt0ceil(mmk*rate/100000) + ' THB' : '';
}
let lock=false;
function syncFrom100k(){
  if(lock) return; lock=true;
  const r = parseNum($('#rate100k').value);
  if(Number.isFinite(r) && r>0) $('#ratePerThb').value = fmt6(100000 / r);
  lock=false; refreshRateNote(); recalc();
}
function syncFromPerThb(){
  if(lock) return; lock=true;
  const inv = parseNum($('#ratePerThb').value);
  if(Number.isFinite(inv) && inv>0) $('#rate100k').value = fmt6(100000 / inv);
  lock=false; refreshRateNote(); recalc();
}
['rate100k','ratePerThb','thbIn','mmkIn'].forEach(id=>{
  document.getElementById(id).addEventListener('input', ()=>{ refreshRateNote(); recalc(); });
});
$('#rate100k').addEventListener('input', syncFrom100k);
$('#ratePerThb').addEventListener('input', syncFromPerThb);
$('#rate100k').value = '820';
syncFrom100k();
recalc();

/* ================= QR setup ================= */
const QR_BASE = 'assets/qr/'; // ✅ new hosting (relative)
const QR_FILES = [
  "hba.jpg","hbq.jpg","hkqr.jpg","ht7.jpg","tkpayq.jpg",
  "yba.jpg","ybq.jpg","yka.jpg","ykpayq.jpg","ykq.jpg",
  "yktba.jpg","yktbq.jpg","ysa.jpg","yt7.jpg","ytq.jpg","ywaveq.jpg"
].sort((a,b)=>{
  const ay=a.startsWith('y');
  const by=b.startsWith('y');
  if(ay && !by) return -1;
  if(!ay && by) return 1;
  return a.localeCompare(b);
});

const qrSelect = document.getElementById('qrSelect');
for(const f of QR_FILES){
  const o=document.createElement('option');
  o.value=f;
  o.textContent=f.replace(/\.[^.]+$/,'');
  qrSelect.appendChild(o);
}

let CURRENT_QR_URL = null;
let CURRENT_QR_LABEL = '';

function refreshQrPreview(){
  const file = qrSelect.value;
  const label = qrSelect.options[qrSelect.selectedIndex].text;
  CURRENT_QR_LABEL = label;

  document.getElementById('qrPreviewName').textContent = label;

  const url = new URL(QR_BASE + file, window.location.href).href;
  CURRENT_QR_URL = url;

  const img = document.getElementById('qrPreview');
  document.getElementById('qrStatus').textContent = 'QR တင်နေပါတယ်...';

  img.onload = () => document.getElementById('qrStatus').textContent = 'OK ✅ Found';
  img.onerror = () => document.getElementById('qrStatus').textContent = `မတွေ့ ❌ (${QR_BASE}${file})`;

  img.src = url + (url.includes('?')?'&':'?') + 'v=' + Date.now();
}
qrSelect.addEventListener('change', refreshQrPreview);
refreshQrPreview();

/* ================= BANK INFO (your data) ================= */
const BANK_INFO = {
  KTB: {
    name: "Krungthai Bank",
    logo: "assets/logo/krungthai.jpg",
    accName: "YE LYNN HTUN",
    accNo: "4970619778"
  },
  BBL: {
    name: "Bangkok Bank",
    logo: "assets/logo/bangkok.jpg",
    accName: "YE LYNN HTUN",
    accNo: "229-4-266305"
  },
  KBZ: {
    name: "KBZ Bank",
    logo: "assets/logo/kbz.jpg",
    accName: "YE LYNN HTUN",
    accNo: "1911 3720 2003 6190 1"
  },
  KPAY_YLH: {
    name: "KPay - YLH",
    logo: "assets/logo/kpay.jpg",
    accName: "YE LYNN HTUN",
    accNo: "09262712854"
  },
  KPAY_TDW: {
    name: "KPay - TDW",
    logo: "assets/logo/kpay.jpg",
    accName: "THIDAR WIN",
    accNo: "09452341813"
  },
  KPAY_HSA: {
    name: "KPay - HSA",
    logo: "assets/logo/kpay.jpg",
    accName: "HEIN SET AUNG",
    accNo: "09264947944"
  },
  KPLUS: {
    name: "Karsikorn - ကာစီကွန်ဘဏ်",
    logo: "assets/logo/kplus.jpg",
    accName: "YE LYNN HTUN",
    accNo: "186-1-85075-3"
  },
  WAVE: {
    name: "Wave Money",
    logo: "assets/logo/wave.jpg",
    accName: "YE' LIN TUN",
    accNo: "09262712854"
  }
};

// Dropdown build (keep order)
const bankSelect = document.getElementById('bankSelect');
const bankOrder = ["KTB","BBL","KBZ","KPLUS","KPAY_YLH","KPAY_TDW","KPAY_HSA","WAVE"];
const bankLabel = k => BANK_INFO[k]?.name || k;

(function buildBankDropdown(){
  const opt0=document.createElement('option');
  opt0.value='';
  opt0.textContent='— ဘဏ်ရွေးပါ —';
  bankSelect.appendChild(opt0);

  for(const key of bankOrder){
    if(!BANK_INFO[key]) continue;
    const o=document.createElement('option');
    o.value=key;
    o.textContent=bankLabel(key);
    bankSelect.appendChild(o);
  }
})();

function refreshBankInfo(){
  const key = bankSelect.value;
  const box = document.getElementById('bankInfoBox');
  const mini = document.getElementById('bankPreviewMini');
  const status = document.getElementById('bankInfoStatus');

  if(!key || !BANK_INFO[key]){
    box.classList.add('hidden');
    mini.textContent = 'ဘဏ်မရွေးထားသေးပါ။';
    status.textContent = '';
    return;
  }

  const info = BANK_INFO[key];

  document.getElementById('bankLogo').src = info.logo + '?v=' + Date.now();
  document.getElementById('bankNameText').textContent = info.name;
  document.getElementById('bankAccName').textContent = info.accName;
  document.getElementById('bankAccNo').textContent = info.accNo;

  box.classList.remove('hidden');
  mini.innerHTML = `
    <div class="font-semibold flex items-center gap-2">
      <img src="${info.logo}?v=${Date.now()}" style="width:22px;height:22px;border-radius:6px;border:1px solid #e5e7eb;object-fit:cover;" />
      <span>${info.name}</span>
    </div>
    <div class="mt-1">အကောင့်နာမည်: <span class="font-semibold">${info.accName}</span></div>
    <div class="mt-1">အကောင့်နံပါတ်: <span class="font-mono font-semibold">${info.accNo}</span></div>
  `;
  status.textContent = 'OK ✅ Bank info loaded';
}
bankSelect.addEventListener('change', refreshBankInfo);

/* ================= Save options (ONE only) ================= */
function getSaveMode(){
  const el = document.querySelector('input[name="saveMode"]:checked');
  return el ? el.value : 'none';
}

/* ================= Save JPEG ================= */
async function saveSectionAsJpeg(sectionId, filename){
  await document.fonts?.ready;

  const original = document.getElementById(sectionId);
  const clone = original.cloneNode(true);
  clone.querySelectorAll('button').forEach(b=>b.remove());

  const mode = getSaveMode();

  // --- append bank or qr (only one) ---
  if(mode === 'qr' && CURRENT_QR_URL){
    const wrap = document.createElement('div');
    wrap.className = 'export-block';

    const title = document.createElement('p');
    title.className = 'text-slate-800 font-semibold';
    title.textContent = 'ငွေလွှဲရန်ဘဏ် QR';

    const img = document.createElement('img');
    img.alt = 'Bank QR';
    img.style.width = '260px';
    img.style.margin = '10px auto 0';
    img.style.border = '1px solid #e5e7eb';
    img.style.borderRadius = '14px';
    img.style.padding = '8px';
    img.style.background = '#fff';
    img.style.display = 'block';
    img.src = CURRENT_QR_URL + (CURRENT_QR_URL.includes('?')?'&':'?') + 'v=' + Date.now();

    const name = document.createElement('p');
    name.className = 'font-semibold mt-2';
    name.textContent = CURRENT_QR_LABEL;

    wrap.appendChild(title);
    wrap.appendChild(img);
    wrap.appendChild(name);
    clone.appendChild(wrap);

    await new Promise(res=>{
      if(img.complete) return res();
      img.onload = () => res();
      img.onerror = () => res();
    });
  }

  if(mode === 'bank'){
    const key = bankSelect.value;
    if(key && BANK_INFO[key]){
      const info = BANK_INFO[key];

      const wrap = document.createElement('div');
      wrap.className = 'export-block';

      const title = document.createElement('p');
      title.className = 'text-slate-800 font-semibold';
      title.textContent = 'ငွေလွှဲရန် ဘဏ်အချက်အလက်';

      const box = document.createElement('div');
      box.style.maxWidth = '560px';
      box.style.margin = '10px auto 0';
      box.style.border = '1px solid #e5e7eb';
      box.style.borderRadius = '14px';
      box.style.padding = '12px';
      box.style.background = '#fff';
      box.style.textAlign = 'left';

      const logo = document.createElement('img');
      logo.src = info.logo + '?v=' + Date.now();
      logo.alt = 'Bank Logo';
      logo.style.width = '44px';
      logo.style.height = '44px';
      logo.style.borderRadius = '10px';
      logo.style.border = '1px solid #e5e7eb';
      logo.style.objectFit = 'cover';

      const headerRow = document.createElement('div');
      headerRow.style.display = 'flex';
      headerRow.style.alignItems = 'center';
      headerRow.style.gap = '10px';
      headerRow.style.marginBottom = '8px';

      const h = document.createElement('div');
      h.innerHTML = `<div style="font-weight:800;font-size:16px">${info.name}</div>
                     <div style="color:#64748b;font-size:12px">Bank Information</div>`;

      headerRow.appendChild(logo);
      headerRow.appendChild(h);

      const body = document.createElement('div');
      body.innerHTML = `
        <div style="margin-top:6px;color:#475569;font-size:14px;">
          ဘဏ်အကောင့်နာမည်: <span style="font-weight:800;color:#0f172a">${info.accName}</span>
        </div>
        <div style="margin-top:4px;color:#475569;font-size:14px;">
          ဘဏ်အကောင့်နံပါတ်: <span style="font-weight:800;color:#0f172a;font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, monospace">${info.accNo}</span>
        </div>
      `;

      box.appendChild(headerRow);
      box.appendChild(body);

      wrap.appendChild(title);
      wrap.appendChild(box);
      clone.appendChild(wrap);

      // ensure logo is loaded
      await new Promise(res=>{
        if(logo.complete) return res();
        logo.onload = () => res();
        logo.onerror = () => res();
      });
    }
  }

  // --- offscreen render ---
  clone.style.position='fixed';
  clone.style.left='-99999px';
  clone.style.top='0';
  clone.style.width = original.offsetWidth + 'px';
  clone.style.background = '#fff';
  document.body.appendChild(clone);

  await new Promise(r=>requestAnimationFrame(r));
  await new Promise(r=>requestAnimationFrame(r));

  const canvas = await html2canvas(clone,{
    backgroundColor:'#ffffff',
    scale: Math.min(2, window.devicePixelRatio*1.5),
    useCORS:true,
    allowTaint:false,
    logging:false
  });

  document.body.removeChild(clone);

  // --- title on top ---
  const margin=20, titleHeight=28;
  const out=document.createElement('canvas');
  out.width = canvas.width + margin*2;
  out.height = canvas.height + margin*3 + titleHeight;

  const ctx = out.getContext('2d');
  ctx.fillStyle='#fff'; ctx.fillRect(0,0,out.width,out.height);
  ctx.fillStyle='#000'; ctx.font='bold 35px system-ui, sans-serif';
  ctx.textAlign='center'; ctx.textBaseline='top';
  ctx.fillText('Thailand Guide - Supplier By Ye', out.width/2, margin);
  ctx.drawImage(canvas, margin, margin*2 + titleHeight);

  const a=document.createElement('a');
  a.href = out.toDataURL('image/jpeg',0.92);
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  setTimeout(()=>document.body.removeChild(a),0);
}

document.getElementById('btnSave1').addEventListener('click', ()=>saveSectionAsJpeg('box-thb2mmk','thb-to-mmk.jpg'));
document.getElementById('btnSave2').addEventListener('click', ()=>saveSectionAsJpeg('box-mmk2thb','mmk-to-thb.jpg'));
</script>

</body>
</html>
